<script>
async function checkPassword() {
  if (!sessionStorage.getItem('galleryAccess')) {
    let input = prompt("Enter the password to access the gallery:");
    if (!input) return;
    try {
      const response = await fetch('http://localhost:3001/auth', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: input })
      });
      const result = await response.json();
      if (result.success) {
        sessionStorage.setItem('galleryAccess', 'true');
        window.location.href = "gallery.html";
      } else {
        alert("Incorrect password. Please reload the page to try again.");
      }
    } catch (err) {
      alert("Could not connect to password server.");
    }
  }
}
checkPassword();

window.addEventListener('visibilitychange', function() {
  if (document.hidden) {
    sessionStorage.removeItem('galleryAccess');
  } else if (!sessionStorage.getItem('galleryAccess')) {
    checkPassword();
  }
});
</script>